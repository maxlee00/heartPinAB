<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>퀴즈</title>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SFN9HYKG8Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SFN9HYKG8Q');
  </script>
</head>
<body>
  <main style="max-width:720px;margin:40px auto;padding:0 16px;">
    <h2>질문</h2>
    <div id="qBox"></div>
    <div style="margin-top:16px;">
      <button id="nextBtn">다음</button>
    </div>
  </main>

  <script src="app.js"></script>
  <script>
    initExperiment();
    track('view_quiz');

    // 8문항: 각 축 2문항 고정
    // 4지선다 선택지는 "왼쪽 성향 강/약" + "오른쪽 성향 약/강" 구조
    // 가중치는 app.js의 WEIGHTS_4=[88, 62, 34, 16]로 자동 처리됨 (50:50 절대 불가)

    const questions = [
      // (E vs I)
      { dim: "EI", q: "연인과 오랜만에 주말 하루를 통째로 보낼 수 있다. 당신이 생각하는 이상적인 데이트는?", 
        leftChar: "E", rightChar: "I",
        a: ["사람 많은 핫플을 돌아다니며, 에너지 넘치게 놀고 싶다",
            "새로운 장소를 가긴 하되, 사람이 너무 많은 곳은 피하고 싶다", 
            "조용한 카페나 산책 위주로 편안하게 시간을 보내고 싶다", 
            "집이나 한적한 공간에서 둘만 오롯이 쉬는게 최고다."] 
      },
      { dim: "EI", q: "연인과의 연락이나 만남 빈도에 대해 가장 가까운 생각은?", 
        leftChar: "E", rightChar: "I",
        a: ["보고 싶을 때마다 바로 연락하고 자주 만나는 게 좋다",
            "시간이 나면 연락하고 자주 보는 편이 좋다", 
            "필요할 때 중심으로 연락하고 만나는 게 편하다", 
            "연락과 최소한으로, 만나기 전에만 연락하는게 좋다"] 
      },

      // (N vs S)
      { dim: "NS", q: "저기.. 번호 좀 줄래요? 연인이 상황극을 시도할 때 내 반응은?", 
        leftChar: "N", rightChar: "S",
        a: ["저 남자(여자)친구 있어요~ 라며 능청스럽게 상황극을 끝까지 이어간다", 
            "웃으며 가볍게 받아주되, 너무 길게 끌지는 않는다.", 
            "웃고 넘기긴 하는데, 바로 '무슨 일 있어?'처럼 현실 대화로 돌린다", 
            "아 뭐하는거야. 굳이 상황극을 받지 않는다"] 
      },
      { dim: "NS", q: "연인의 말투나 행동이 평소와 달라졌다면, 나는?", 
        leftChar: "N", rightChar: "S",
        a: ["연인의 말투 하나하나에도 의미부여하며, 잘못한 것이 없는지 되짚어본다",
            "관계나 감정에 변화가 있는 게 아닐까 마음 졸인다", 
            "요즘 연인의 일정이나 상황을 생각하며 이해하려 노력한다", 
            "구체적인 이유를 듣기 전까지 크게 의미를 부여하지 않는다"] 
      },

      // TF (T vs F)
      { dim: "TF", q: "연인이 서운함을 말했을 때 나는?", 
        leftChar: "T", rightChar: "F",
        a: ["'뭐가 그렇게 서운했어?' 서운함의 원인을 찾아 해결책을 생각한다", 
            "'그게 왜 서운하지?' 라고 생각하지만, 이해하려고 노력한다", 
            "'그랬을 수 있겠다.'라며 감정을 받아주고 이야기를 들어본다.", 
            "'서운하게 해서 미안해.'라며 공감과 위로를 우선한다."] 
      },
      { dim: "TF", q: "연인과 영화를 보고 나왔을때 가장 먼저 보이는 반응은?", 
        leftChar: "T", rightChar: "F",
        a: ["이 영화가 말하려는 메시지나 주제가 뭔지부터 얘기한다",
            "전개나 결말이 왜 그렇게 흘러갔는지를 생각하며 이야기한다",
            "재미있었는지, 어떤 장면이 인상 깊었는지 감상 위주로 이야기한다", 
            "좋았는지 싫었는지와 같은 느낌부터 나눈다."] 
      },

      // JP (J vs P)
      { dim: "JP", q: "연인과 여행을 가기 전 나의 준비 상태는?", 
        leftChar: "J", rightChar: "P",
        a: ["일정/동선/예약까지 미리 다 표로 정리해서 연인에게 공유한다", 
            "큰 일정과 핵심 포인트 위주로 정리해서 시간표를 짜둔다", 
            "오고가는 시간만 정하고, 아무것도 미리 정하지 않는다", 
            "우선 옷만 챙기고, 집을 나서며 즉흥적으로 여행을 간다"] 
      },
      { dim: "JP", q: "평일 저녁, '나 지금 보러가도 돼?'라며 갑작스레 온 연인의 연락, 당신의 반응은?", 
        leftChar: "J", rightChar: "P",
        a: ["'응 당연히 되지!' 즉흥적인 연인의 스타일까지 반영해 계획을 짜두었다", 
            "'아.. 오늘은 좀 힘들 것 같아.' 이미 계획해둔 휴식이나 일정이 있어 다음으로 미룬다", 
            "'완전 좋지' 특별히 안될 이유가 없으면 흔쾌히 괜찮다고 이야기한다", 
            "'나 이미 가고 있잖아.' 생각할 것도 없이 바로 준비해서 먼저 나간다"] 
      },
    ];

    let idx = 0;
    const picks = []; // 0~3 저장

    function render() {
      const q = questions[idx];
      document.getElementById('qBox').innerHTML = `
        <p><b>${idx + 1}. ${q.q}</b></p>
        ${q.a.map((t, i) => `
          <label style="display:block;margin:10px 0;">
            <input type="radio" name="ans" value="${i}"> ${t}
          </label>
        `).join('')}
      `;
    }

    document.getElementById('nextBtn').addEventListener('click', () => {
      const picked = document.querySelector('input[name="ans"]:checked');
      if (!picked) { alert("하나 선택해줘"); return; }

      const pickIdx = Number(picked.value); // 0~3
      picks.push(pickIdx);

      track('answer_question', { q_index: idx, pick: pickIdx });

      idx++;

      if (idx >= questions.length) {
        // 답변 저장
        sessionStorage.setItem("hp_picks_v2", JSON.stringify(picks));

        // MBTI 계산 (app.js 함수 사용)
        const { mbti, score } = calcWeightedMbti(picks, questions);

        sessionStorage.setItem("hp_mbti_v1", mbti);
        sessionStorage.setItem("hp_score_v1", JSON.stringify(score));

        // 제출 이벤트
        track('submit_test', {
          mbti,
          // 간단 요약: 0~3을 문자열로
          picks: picks.join(''),
          // 점수 일부(원하면 더 보내도 됨)
          ei: `${score.EI.E}/${score.EI.I}`,
          ns: `${score.NS.N}/${score.NS.S}`,
          tf: `${score.TF.T}/${score.TF.F}`,
          jp: `${score.JP.J}/${score.JP.P}`,
        });

        location.href = 'result.html';
        return;
      }

      render();
    });

    render();
  </script>
</body>
</html>
